<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Pessoas</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        form { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>CRUD de Pessoas</h1>

    <!-- Tabela de Pessoas -->
    <table id="pessoasTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Sobrenome</th>
                <th>Gênero</th>
                <th>Telefone</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <!-- Linhas serão inseridas via JavaScript -->
        </tbody>
    </table>

    <!-- Formulário para Adicionar/Editar Pessoas -->
    <form id="pessoaForm">
        <h2 id="formTitle">Adicionar Pessoa</h2>
        <input type="hidden" id="pessoaId">
        <label>
            Nome:
            <input type="text" id="nome" required>
        </label>
        <br>
        <label>
            Sobrenome:
            <input type="text" id="sobrenome" required>
        </label>
        <br>
        <label>
            Gênero:
            <input type="text" id="genero" required>
        </label>
        <br>
        <label>
            Telefone:
            <input type="text" id="telefone" required>
        </label>
        <br><br>
        <button type="submit">Salvar</button>
    </form>

    <script>
        const apiUrl = 'http://localhost:8080/api/pessoas';

        // Carregar Pessoas ao Abrir a Página
        async function carregarPessoas() {
            const response = await fetch(apiUrl);
            const pessoas = await response.json();
            const tbody = document.querySelector('#pessoasTable tbody');
            tbody.innerHTML = ''; // Limpar tabela antes de recarregar

            pessoas.forEach(pessoa => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${pessoa.id}</td>
                    <td>${pessoa.nome}</td>
                    <td>${pessoa.sobrenome}</td>
                    <td>${pessoa.genero}</td>
                    <td>${pessoa.telefone}</td>
                    <td>
                        <button onclick="editarPessoa(${pessoa.id})">Editar</button>
                        <button onclick="deletarPessoa(${pessoa.id})">Deletar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Salvar Pessoa (Adicionar ou Editar)
        document.getElementById('pessoaForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const id = document.getElementById('pessoaId').value;
            const nome = document.getElementById('nome').value;
            const sobrenome = document.getElementById('sobrenome').value;
            const genero = document.getElementById('genero').value;
            const telefone = document.getElementById('telefone').value;

            const pessoa = { nome, sobrenome, genero, telefone };

            if (id) {
                // Editar Pessoa
                await fetch(`${apiUrl}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(pessoa),
                });
            } else {
                // Adicionar Pessoa
                await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(pessoa),
                });
            }

            document.getElementById('pessoaForm').reset();
            document.getElementById('formTitle').innerText = 'Adicionar Pessoa';
            carregarPessoas();
        });

        // Editar Pessoa
        async function editarPessoa(id) {
            const response = await fetch(`${apiUrl}/${id}`);
            const pessoa = await response.json();

            document.getElementById('pessoaId').value = pessoa.id;
            document.getElementById('nome').value = pessoa.nome;
            document.getElementById('sobrenome').value = pessoa.sobrenome;
            document.getElementById('genero').value = pessoa.genero;
            document.getElementById('telefone').value = pessoa.telefone;
            document.getElementById('formTitle').innerText = 'Editar Pessoa';
        }

        // Deletar Pessoa
        async function deletarPessoa(id) {
            await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
            carregarPessoas();
        }

        // Inicializar
        carregarPessoas();
    </script>
</body>
</html>
